\section{YLD0418P}
In \cite{SouzaNeto2008}, an anisotropic yield criterion named as the Barlat--Lian criterion \cite{Barlat1989} is discussed in the context of plane stress for sheet metals.
The yield criterion was further generalised \cite{Barlat2003} and extended to the 3D space \cite{Barlat2005}, which is known as the YLD2004-18P criterion since it was formulated in 2004 and has 18 parameters.
Here, we use a slightly different notation, YLD0418P, to denote this criterion.
\subsection{Miscellaneous Aspects}
Before introducing the yield criterion, we shall first introduce some miscellaneous aspects to make it a complete plasticity model.
Namely, one needs to provide the corresponding elasticity, flow rule and hardening law.

For elasticity, we assume either isotropic or orthotropic elasticity such that
\begin{gather}
    \bsigma=\mb{E}\left(\bvarepsilon-\bvarepsilon^p\right),
\end{gather}
where $\mb{E}$ is the elastic stiffness matrix that can be either isotropic or orthotropic.
Because in the following both matrix and tensor notations may be used, the elasticity may also be equivalently expresssed in tensor notation as
\begin{gather}
    \bsigma=\mb{D}:\left(\bvarepsilon-\bvarepsilon^p\right).
\end{gather}
The convention is simple: when $\mb{D}$ is used, it represents a tensor, thus tensor operations are required, while when $\mb{E}$ is used, it represents a matrix, thus matrix operations are required.
For the flow rule, we assume the associative plasticity such that the plastic potential is identical to the yield function.
\begin{gather}
    \dot{\bvarepsilon^p}=\gamma\bn=\gamma\pdfrac{f}{\bsigma}.
\end{gather}
For the hardening rule, let the isotropic yield stress be a function of the accumulated equivalent plastic strain $\varepsilon^p$.
\begin{gather}
    \sigma_y=H\left(\varepsilon^{p}\right),
\end{gather}
with
\begin{gather}
    \dot{\varepsilon^p}=\sqrt{\dfrac{2}{3}\dot{\bvarepsilon^p}:\dot{\bvarepsilon^p}}=\gamma\sqrt{\dfrac{2}{3}\underbrace{\bn:\bn}_\text{tensor}}=\gamma\sqrt{\dfrac{2}{3}\underbrace{\bn^\mT\mb{T}\bn}_\text{vector}},
\end{gather}
with $\mb{T}=\diag{\begin{matrix}
            1 & 1 & 1 & \dfrac{1}{2} & \dfrac{1}{2} & \dfrac{1}{2}
        \end{matrix}}$.
Both rules are effectively identical to the ones introduced previously in \S~\ref{sec:hoffman}.
However, since we only focus on the yield criterion in this section, we are not going to explore various alternatives.
Nevertheless, one shall be aware of the fact that based on the framework presented here, it is relatively easy to employ more complex hardening rules.
\subsection{Derivatives of Eigenvalues and Eigenvectors}\label{sec:derivative_eigen}
Now let $\lambda_i$ be the eigenvalues of the stress tensor $\mb{\aleph}$ and $\bv_i$ be the corresponding normalized eigenvectors, one has
\begin{gather}\label{eq:eigenvalue_def}
    \lambda_i=\underbrace{\bv_i^\mT\mb{\aleph}\bv_i}_{\text{vector/matrix}}=\underbrace{\bv_i\cdot\mb{\aleph}\cdot\bv_i}_{\text{tensor contraction}}=\underbrace{\left(\bv_i\otimes\bv_i\right):\mb{\aleph}}_{\text{tensor contraction}},\qquad
    \mb{\aleph}=\sum_{i}\lambda_i\bv_i\otimes\bv_i.
\end{gather}
The first attribute to note is that since $\bv_i$ is normalized, viz., $\bv_i\cdot\bv_i=1$, then
\begin{gather}
    \md{\left(\bv_i\cdot\bv_i\right)}=\md{\bv_i}\cdot\bv_i+\bv_i\cdot\md{\bv_i}=2\bv_i\cdot\md{\bv_i}=\md{1}=0\qquad\longrightarrow\qquad\bv_i\cdot\md{\bv_i}=0.
\end{gather}
Without loss of generality, one arrives at the conclusion that the change of a unit vector (or first order tensor) is perpendicular to the vector/tensor itself, i.e., $\bv_i\perp\md{\bv_i}$.
With this, it is possible to further write
\begin{gather}
    \md{\bv_i}\cdot\mb{\aleph}\cdot\bv_i=\lambda_i\cdot\md{\bv_i}\cdot\bv_i=0,
\end{gather}
thus, the differentiation of $\lambda_i$ can be expressed as
\begin{gather}\label{eq:eigenvalue_diff_def}
    \md{\lambda_i}=\md{\bv_i}\cdot\mb{\aleph}\cdot\bv_i+\bv_i\cdot\md{\mb{\aleph}}\cdot\bv_i+\bv_i\cdot\mb{\aleph}\cdot\md{\bv_i}=\bv_i\cdot\md{\mb{\aleph}}\cdot\bv_i+2\md{\bv_i}\cdot\mb{\aleph}\cdot\bv_i=\bv_i\cdot\md{\mb{\aleph}}\cdot\bv_i.
\end{gather}
Comparing \eqsref{eq:eigenvalue_def} and \eqsref{eq:eigenvalue_diff_def}, it is quite interesting to note that the mapping between $\lambda_i$ and $\mb{\aleph}$ is identical to that between $\md{\lambda_i}$ and $\md{\mb{\aleph}}$.
Alternatively, the above expressions are equivalent to the following,
\begin{gather}
    \md{\lambda_i}=\left(\bv_i\otimes\bv_i\right):\md{\mb{\aleph}}=\mb{P}_{ii}:\md{\mb{\aleph}}.
\end{gather}
We have defined $\mb{P}_{ii}=\bv_i\otimes\bv_i$ as a second order tensor.
Just like the stress/strain tensor, since $\mb{P}_{ii}$ is symmetric, it can also be expressed in the Voigt vector form.
In matrix form,
\begin{gather}
    \lambda_i=\underbrace{\mb{P}_{ii}}_{1\times6}\underbrace{\mb{\aleph}}_{6\times1},\qquad
    \md{\lambda_i}=\underbrace{\mb{P}_{ii}}_{1\times6}\underbrace{\md{\mb{\aleph}}}_{6\times1}.
\end{gather}
Note the double contraction is embedded in $\mb{P}_{ii}$, thus, the explicit matrix form of $\mb{P}_{ii}$ shall contain the corresponding scaling factor, which shall be
\begin{gather}
    \lambda_i=\underbrace{\mb{P}_{ii}}_{1\times6}\underbrace{\mb{\aleph}}_{6\times1}=\begin{bmatrix}
        \bv_{i,1}^2 & \bv_{i,2}^2 & \bv_{i,3}^2 & 2\bv_{i,1}\bv_{i,2} & 2\bv_{i,2}\bv_{i,3} & 2\bv_{i,3}\bv_{i,1}
    \end{bmatrix}\begin{bmatrix}
        \mb{\aleph}_{11} \\\mb{\aleph}_{22}\\\mb{\aleph}_{33}\\\mb{\aleph}_{12}\\\mb{\aleph}_{23}\\\mb{\aleph}_{31}
    \end{bmatrix}.
\end{gather}
One can also keep both the Voigt representation and the double contraction by defining
\begin{gather}
    \lambda_i=\underbrace{\mb{P}_{ii}}_{1\times6}:\underbrace{\mb{\aleph}}_{6\times1}=\begin{bmatrix}
        \bv_{i,1}^2 & \bv_{i,2}^2 & \bv_{i,3}^2 & \bv_{i,1}\bv_{i,2} & \bv_{i,2}\bv_{i,3} & \bv_{i,3}\bv_{i,1}
    \end{bmatrix}\diag{\begin{matrix}1\\1\\1\\2\\2\\2\end{matrix}}\begin{bmatrix}
        \mb{\aleph}_{11} \\\mb{\aleph}_{22}\\\mb{\aleph}_{33}\\\mb{\aleph}_{12}\\\mb{\aleph}_{23}\\\mb{\aleph}_{31}
    \end{bmatrix}.
\end{gather}
Such a mixed notation may appear to be a bit confusing, but it is actually quite useful in practice.

For $\md{\bv_i}$ itself, it can be derived, see \cite{Wu2006} and the references therein, and explicitly expressed as
\begin{gather}\label{eq:eigenvector_diff_def}
    \md{\bv_i}=\sum_{j=1,i\neq{}j}^3\dfrac{\mb{P}_{ij}:\md{\mb{\aleph}}}{\lambda_i-\lambda_j}\bv_j
\end{gather}
with $\mb{P}_{ij}=\dfrac{1}{2}\left(\bv_i\otimes\bv_j+\bv_j\otimes\bv_i\right)$ being also a symmetric second order tensor.
It can be observed that $ \md{\bv_i}$ is a linear combination of the other two eigenvectors.
Since $\bv_i\cdot\bv_j=\delta_{ij}$, indeed $\md{\bv_i}\cdot\bv_i=0$.
\eqsref{eq:eigenvector_diff_def} allows the following.
\begin{gather}
    \begin{split}
        \md{\mb{P}_{ii}}=\md{\left(\bv_i\otimes\bv_i\right)}=2\md{\bv_i}\otimes\bv_i & =2\sum_{j=1,i\neq{}j}^3\dfrac{\mb{P}_{ij}:\md{\mb{\aleph}}}{\lambda_i-\lambda_j}\bv_j\otimes\bv_i \\&=2\sum_{j=1,i\neq{}j}^3\dfrac{\mb{P}_{ij}:\md{\mb{\aleph}}}{\lambda_i-\lambda_j}\mb{P}_{ij}=2\sum_{j=1,i\neq{}j}^3\dfrac{\mb{P}_{ij}\otimes\mb{P}_{ij}}{\lambda_i-\lambda_j}:\md{\mb{\aleph}}.
    \end{split}
\end{gather}
It is assumed that $\lambda_i\neq\lambda_j$, that is, the eigenvalues are distinct.
For degenerated cases, the above expression is \textbf{not} valid.
But is it actually a problem?
In practice, it's likely that the algorithm used to perform eigen analysis is iterative, exactly identical eigenvalues are not likely to be obtained.
This is also guaranteed by the fact that $\mb{\aleph}$ are transformed tensors.
Unless carefully designed, to obtain very close eigenvalues is practically difficult, let alone exactly identical eigenvalues.
We will revisit this issue later.
\subsection{Yield Function}\label{sec:yld0418p_yield_function}
The YLD0418P yield criterion is expressed as a function of a set of \textbf{transformed} stress tensors, that is, in its most general form,
\begin{gather}
    f=f\left(\balpha,\bbeta,\bgamma,\cdots\right),
\end{gather}
where $\balpha$, $\bbeta$, $\bgamma$ are the transformed stress tensors that can be obtained by linear transformations of the deviatoric stress tensor $\bs=\dev{\bsigma}$.
In matrix form, for example,
\begin{gather}
    \mb{\aleph}=\mb{C_\aleph}\bs,
\end{gather}
where $\mb{\aleph}$ is the transformed stress tensor (any of $\balpha$, $\bbeta$, etc.), and $\mb{C_\aleph}$ is the corresponding constant transformation matrix that has the following structure.
\begin{gather}
    \mb{C_\aleph}=
    \begin{bmatrix}
                              & -C^{\mb{\aleph}}_{12} & -C^{\mb{\aleph}}_{13} &                      &                      &                      \\[2mm]
        -C^{\mb{\aleph}}_{21} &                       & -C^{\mb{\aleph}}_{23} &                      &                      &                      \\[2mm]
        -C^{\mb{\aleph}}_{31} & -C^{\mb{\aleph}}_{32} &                       &                      &                      &                      \\[2mm]
                              &                       &                       & C^{\mb{\aleph}}_{44} &                      &                      \\[2mm]
                              &                       &                       &                      & C^{\mb{\aleph}}_{55} &                      \\[2mm]
                              &                       &                       &                      &                      & C^{\mb{\aleph}}_{66}
    \end{bmatrix}.
\end{gather}
As mainly discussed in \cite{Barlat2005}, the YLD0418P yield function only focus on two of those transformed stress tensors, namely $\balpha$ and $\bbeta$.
Let $\alpha_i$ and $\beta_i$ ($i\in\{1,2\}$ for 2D and $i\in\{1,2,3\}$ for 3D) be the principal values of $\balpha$ and $\bbeta$, viz., the eigenvalues of the corresponding tensors.
In 3D stress space, the yield function is then expressed as
\begin{gather}\label{eq:yld0418p_yield_function}
    f=\sum_{i=1,j=1}^3\abs{\alpha_i-\beta_j}^m-4\sigma_y^m.
\end{gather}
In above, the exponent $m$ is a model parameter that controls the shape of the yield surface.
One can spot a few interesting features of \eqsref{eq:yld0418p_yield_function}.
\begin{enumerate}
    \item The shape is controlled by principal stresses.
    \item The summation involves nine terms in total.
    \item Depending on the parameters used to define the transformation matrices, the transformed stresses $\balpha$ and $\bbeta$ may or may not share the same principal directions.
    \item Noting that $\bs$ is a deviatoric stress tensor, thus the yield function is hydrostatic pressure independent. However, $\balpha$ and $\bbeta$ may or may not be deviatoric --- depending on the transformation matrices.
\end{enumerate}

It is important to also notice that $f$ has a unit of that of stress.
Considering that $m$ could be potentially (very) large, up to \num{40} or so, to avoid numerical issues, we use the following revision in this section.
\begin{gather}\label{eq:yld0418p_yield_function_normalized}
    f=\sum_{i=1}^3\sum_{j=1}^3\abs{\dfrac{\alpha_i-\beta_j}{\sigma_\text{ref}}}^m-4\sigma_y^m,
\end{gather}
where $\sigma_\text{ref}$ is a reference stress.
As a result, $\sigma_y$ shall be dimensionless and evaluates to unity for zero plastic strain.

It is necessary to derive the gradients of $f$ in order to implement the plasticity model.
Using the chain rule, by denoting $\Delta_{ij}=\dfrac{\alpha_i-\beta_j}{\sigma_\text{ref}}$, it is straightforward to derive the following.
\begin{gather}
    \pdfrac{f}{\alpha_i}=\dfrac{m}{\sigma_\text{ref}}\sum_{j=1}^3\abs{\Delta_{ij}}^{m-1}\sign{\Delta_{ij}}=\dfrac{m}{\sigma_\text{ref}}\sum_{j=1}^3\abs{\Delta_{ij}}^{m-2}\Delta_{ij},\\
    \pdfrac{f}{\beta_j}=-\dfrac{m}{\sigma_\text{ref}}\sum_{i=1}^3\abs{\Delta_{ij}}^{m-1}\sign{\Delta_{ij}}=-\dfrac{m}{\sigma_\text{ref}}\sum_{i=1}^3\abs{\Delta_{ij}}^{m-2}\Delta_{ij},
\end{gather}
and the second order derivatives
\begin{gather}
    \pdfrac{^2f}{\alpha_i^2}=\dfrac{m\left(m-1\right)}{\sigma_\text{ref}^2}\sum_{j=1}^3\abs{\Delta_{ij}}^{m-2},\\
    \pdfrac{^2f}{\beta_j^2}=\dfrac{m\left(m-1\right)}{\sigma_\text{ref}^2}\sum_{i=1}^3\abs{\Delta_{ij}}^{m-2},\\
    \pdfrac{^2f}{\alpha_i\partial\beta_j}=-\dfrac{m\left(m-1\right)}{\sigma_\text{ref}^2}\abs{\Delta_{ij}}^{m-2}.
\end{gather}

We have prepared all necessary ingredients to compute the full derivatives of (the summation term of) the yield function in the previous sections.
\begin{gather}
    \begin{split}
        \pdfrac{f}{\bs} & =\sum_{i=1}^{3}\pdfrac{f}{\alpha_i}\ddfrac{\alpha_i}{\balpha}:\ddfrac{\balpha}{\bs}+\sum_{i=1}^{3}\pdfrac{f}{\beta_i}\ddfrac{\beta_i}{\bbeta}:\ddfrac{\bbeta}{\bs} \\
                        & =\sum_{i=1}^{3}\pdfrac{f}{\alpha_i}\mb{P}_{ii}^{\balpha}:\mb{C}_{\balpha}+\sum_{i=1}^{3}\pdfrac{f}{\beta_i}\mb{P}_{ii}^{\bbeta}:\mb{C}_{\bbeta}.
    \end{split}
\end{gather}
Note that in the above we only consider the contribution of the summation term, while the contribution of $\sigma_y$ is not included.
This is also the reason why we use partial derivative notation in the above expression.
It is possible to rewrite the above expression in a more compact form, using the following notation.
\begin{gather}
    \pdfrac{f}{\balpha}=\underbrace{\begin{bmatrix}
            \pdfrac{f}{\alpha_1} & \pdfrac{f}{\alpha_2} & \pdfrac{f}{\alpha_3}
        \end{bmatrix}}_{1\times3}\underbrace{\begin{bmatrix}
            \mb{P}_{11}^{\balpha} \\[2mm]\mb{P}_{22}^{\balpha}\\[2mm]\mb{P}_{33}^{\balpha}
        \end{bmatrix}}_{3\times6},\qquad
    \pdfrac{f}{\bbeta}=\underbrace{\begin{bmatrix}
            \pdfrac{f}{\beta_1} & \pdfrac{f}{\beta_2} & \pdfrac{f}{\beta_3}
        \end{bmatrix}}_{1\times3}\underbrace{\begin{bmatrix}
            \mb{P}_{11}^{\bbeta} \\[2mm]\mb{P}_{22}^{\bbeta}\\[2mm]\mb{P}_{33}^{\bbeta}
        \end{bmatrix}}_{3\times6}.
\end{gather}
Thus,
\begin{gather}
    \pdfrac{f}{\bs}=\pdfrac{f}{\balpha}:\mb{C}_{\balpha}+\pdfrac{f}{\bbeta}:\mb{C}_{\bbeta}.
\end{gather}
One shall be aware of the fact that in the above expression, double contraction stemming from tensor operations is required between quantities expressed in matrix form.
In explicit matrix form, (the transpose of) the above can be expressed as a column vector
\begin{gather}
    \underbrace{\pdfrac{f}{\bs}}_{6\times1}=\sum_{\mb{\aleph}\in\{\balpha,\bbeta\}}\mb{C}_{\mb{\aleph}}^\mT\underbrace{\begin{bmatrix}
            1 &   &   &   &   &   \\
              & 1 &   &   &   &   \\
              &   & 1 &   &   &   \\
              &   &   & 2 &   &   \\
              &   &   &   & 2 &   \\
              &   &   &   &   & 2
        \end{bmatrix}}_{\text{double contraction scaling}}\underbrace{\begin{bmatrix}
            \mb{P}_{11}^{\mb{\aleph},\mT} & \mb{P}_{22}^{\mb{\aleph},\mT} & \mb{P}_{33}^{\mb{\aleph},\mT}
        \end{bmatrix}}_{6\times3}\underbrace{\begin{bmatrix}
            \pdfrac{f}{\aleph_1} \\[4mm] \pdfrac{f}{\aleph_2} \\[4mm] \pdfrac{f}{\aleph_3}
        \end{bmatrix}}_{3\times1}.
\end{gather}
Accordingly, the plastic flow direction is simply the deviatoric part, that is,
\begin{gather}
    \pdfrac{f}{\bsigma}=\dev{\pdfrac{f}{\bs}}.
\end{gather}

Furthermore,
\begin{gather}\label{eq:yld0418p_dfdaleph}
    \begin{split}
        \pdfrac{^2f}{\mb{\aleph}^2} & =\sum_{i=1}^{3}\left(\pdfrac{^2f}{\aleph_i^2}\mb{P}_{ii}^{\mb{\aleph}}\otimes\mb{P}_{ii}^{\mb{\aleph}}+2\pdfrac{f}{\aleph_i}\sum_{j=1,i\neq{}j}^3\dfrac{\mb{P}_{ij}^{\mb{\aleph}}\otimes\mb{P}_{ij}^{\mb{\aleph}}}{\aleph_i-\aleph_j}\right)                                   \\
                                    & =\sum_{i=1}^{3}\pdfrac{^2f}{\aleph_i^2}\mb{P}_{ii}^{\mb{\aleph}}\otimes\mb{P}_{ii}^{\mb{\aleph}}+\sum_{(i,j)\in\{(12),(23),(31)\}}\dfrac{2}{\aleph_i-\aleph_j}\left(\pdfrac{f}{\aleph_i}-\pdfrac{f}{\aleph_j}\right)\mb{P}_{ij}^{\mb{\aleph}}\otimes\mb{P}_{ij}^{\mb{\aleph}}.
    \end{split}
\end{gather}
In matrix form, if we define
\begin{gather}
    \mb{P}^{\mb{\aleph}}=\underbrace{\begin{bmatrix}
            \mb{P}_{11}^{\mb{\aleph}} \\[3mm]
            \mb{P}_{22}^{\mb{\aleph}} \\[3mm]
            \mb{P}_{33}^{\mb{\aleph}} \\[3mm]
            \mb{P}_{12}^{\mb{\aleph}} \\[3mm]
            \mb{P}_{23}^{\mb{\aleph}} \\[3mm]
            \mb{P}_{31}^{\mb{\aleph}}
        \end{bmatrix}}_{6\times6},
\end{gather}
\eqsref{eq:yld0418p_dfdaleph} can be equivalently expressed as
\begin{gather}
    \pdfrac{^2f}{\mb{\aleph}^2}= \mb{P}^{\mb{\aleph},\mT}\diag{\begin{matrix}
            \pdfrac{^2f}{\aleph_1^2}                                                           \\[3mm]
            \pdfrac{^2f}{\aleph_2^2}                                                           \\[3mm]
            \pdfrac{^2f}{\aleph_3^2}                                                           \\[3mm]
            \dfrac{2}{\aleph_1-\aleph_2}\left(\pdfrac{f}{\aleph_1}-\pdfrac{f}{\aleph_2}\right) \\[3mm]
            \dfrac{2}{\aleph_2-\aleph_3}\left(\pdfrac{f}{\aleph_2}-\pdfrac{f}{\aleph_3}\right) \\[3mm]
            \dfrac{2}{\aleph_3-\aleph_1}\left(\pdfrac{f}{\aleph_3}-\pdfrac{f}{\aleph_1}\right)
        \end{matrix}}\mb{P}^{\mb{\aleph}}.
\end{gather}
What a compact and elegant expression!
The matrix $\mb{P}^{\mb{\aleph}}$ is a projection matrix that purely depends on the eigenvectors.
The diagonal matrix accounts for both the direct second order partial derivatives and the contribution of the rotating eigenvectors.
If we further define $\mb{H}^{\mb{\aleph}}=\mb{P}^{\mb{\aleph}}:\mb{C}_{\mb{\aleph}}$, then,
\begin{gather}
    \pdfrac{^2f}{\bs^2}=\mb{H}^{\mb{\aleph},\mT}\diag{\cdots}\mb{H}^{\mb{\aleph}},
\end{gather}
in which for brevity the middle diagonal matrix is not repeated.

Now let's study the degenerated case when $\alpha_i$ approaches $\alpha_j$.
By examining the expression,
\begin{gather}
    \pdfrac{f}{\alpha_i}=\dfrac{m}{\sigma_\text{ref}}\sum_{j=1}^3\abs{\Delta_{ij}}^{m-2}\Delta_{ij},
\end{gather}
it is easy to see that $\pdfrac{f}{\alpha_i}$ is a function of $\alpha_i$ only (in the sense that the other two principal stresses in $\balpha$ do not appear in the expression).
When $\alpha_i\approx\alpha_j$, the fraction essentially approximates the second order derivative.
\begin{gather}
    \lim_{\aleph_1\approx\aleph_2}\dfrac{2}{\aleph_i-\aleph_j}\left(\pdfrac{f}{\aleph_i}-\pdfrac{f}{\aleph_j}\right)=2\pdfrac{^2f}{\aleph_i^2}\Big|_{\aleph_j}=2\pdfrac{^2f}{\aleph_j^2}\Big|_{\aleph_i}.
\end{gather}
To account for symmetry, it is possible to use $\pdfrac{^2f}{\aleph_i^2}\Big|_{\aleph_j}+\pdfrac{^2f}{\aleph_j^2}\Big|_{\aleph_i}$ to approximate it.

Finally, it must be pointed out that the above derivation, without loss of generality, can be applied to 2D cases \cite{Barlat2003} with minor modifications.

For computing derivatives of eigenvalues and eigenvectors alone, we have used tensor algebra.
Combined with the yield function, we have also employed matrix algebra.
Thus the above expressions are a mixture of both notations.
One shall apply appropriate scaling matrices when necessary.
\subsection{Formulation}
The expressions are summarised in the following table.
\begin{table}[H]
    \centering
    \begin{tabular}{rl}
        \toprule
        Constitutive Law & $\bsigma=\mb{E}\left(\bvarepsilon-\bvarepsilon^p\right)$                                 \\[2mm]
        Yield Function   & $\displaystyle{}f=\sum_{i=1}^3\sum_{j=1}^3\abs{\alpha_i-\beta_j}^m-4\sigma_y^m$          \\[2mm]
        Flow Rule        & $\dot{\bvarepsilon^p}=\gamma\bn=\gamma\cdot\dev{\pdfrac{f}{\bs}}$                        \\[4mm]
        Hardening Law    & $\displaystyle{}\dot{\varepsilon^p}=\gamma\norm{\bn}_e=\gamma\sqrt{\dfrac{2}{3}\bn:\bn}$ \\\bottomrule
    \end{tabular}
\end{table}
\subsubsection{Local System}
It is very important to note that since the yield function $f$ is defined in the deviatoric stress space, it is \textbf{not} possible to take $\bsigma$ as an independent variable as done in the previous orthotropic model.
This is reasonable as it is \textbf{not} possible to determine $\bsigma$ from $\bs$ as the spherical part remains unknown.
Thus, the local variable is taken as $\mb{x}=\underbrace{\begin{bmatrix}\gamma&\bs\end{bmatrix}^\mT}_{7\times1}$, the local system consists of two residuals.
\begin{gather}
    \mb{R}=\left\{\begin{array}{l}\displaystyle
        \sum_{i=1}^3\sum_{j=1}^3\abs{\alpha_i-\beta_j}^m-4\sigma_y^m, \\[4mm]
        \bs+\mb{E}\bn\gamma-\bs^\text{trial}.
    \end{array}\right.
\end{gather}
Only when the material is isotropic, the second residual can be simplified as $\bs+2G\bn\gamma-\bs^\text{trial}$ given that $\bn$ is deviatoric.
For orthotropic materials, there is no concise way to simplify it anymore.
The Jacobian is thus
\begin{gather}
    \mb{J}=\underbrace{\begin{bmatrix}
            -4m\sigma_y^{m-1}\ddfrac{\sigma_y}{\varepsilon^p}\norm{\bn}_e & \pdfrac{f}{\bs}-4m\sigma_y^{m-1}\ddfrac{\sigma_y}{\varepsilon^p}\gamma\ddfrac{\norm{\bn}_e}{\bn}:\mathbb{I}^\text{dev}:\pdfrac{^2f}{\bs^2} \\[4mm]
            \mb{E}\bn                                                     & \mb{I}+\mb{E}\mathbb{I}_\text{dev}:\pdfrac{^2f}{\bs^2}
        \end{bmatrix}}_{7\times7}.
\end{gather}
\subsubsection{Consistent Tangent Stiffness}
From the stress update expression,
\begin{gather}
    \bsigma=\bsigma^\text{trial}-\gamma\mb{E}\bn,
\end{gather}
the consistent tangent stiffness can be derived as
\begin{gather}
    \begin{split}
        \ddfrac{\bsigma}{\bvarepsilon} & =\mb{E}-\mb{E}\left(\gamma\ddfrac{\bn}{\bvarepsilon}+\bn\ddfrac{\gamma}{\bvarepsilon}\right)=\mb{E}-\mb{E}\left(\gamma\mathbb{I}^\text{dev}:\pdfrac{^2f}{\bs^2}\ddfrac{\bs}{\bvarepsilon}+\bn\ddfrac{\gamma}{\bvarepsilon}\right) \\
                                       & =\mb{E}-\mb{E}\begin{bmatrix}
                                                           \bn & \gamma\mathbb{I}^\text{dev}:\pdfrac{^2f}{\bs^2}
                                                       \end{bmatrix}\begin{bmatrix}
                                                                        \ddfrac{\gamma}{\bvarepsilon} \\[4mm]
                                                                        \ddfrac{\bs}{\bvarepsilon}
                                                                    \end{bmatrix}=\mb{E}-\mb{E}\mathbb{I}^\text{dev}:\begin{bmatrix}
                                                                                                                         \pdfrac{f}{\bs} & \gamma\pdfrac{^2f}{\bs^2}
                                                                                                                     \end{bmatrix}\ddfrac{\mb{x}}{\bvarepsilon}.
    \end{split}
\end{gather}
In the above, $\ddfrac{\mb{x}}{\bvarepsilon}$ can be obtained from the local equilibrium,
\begin{gather}
    \md{\mb{R}}=\pdfrac{\mb{R}}{\mb{x}}\md{\mb{x}}+\pdfrac{\mb{R}}{\bvarepsilon}\md{\bvarepsilon}=\mb{0}\qquad\longrightarrow\qquad\ddfrac{\mb{x}}{\bvarepsilon}=-\mb{J}^{-1}\pdfrac{\mb{R}}{\bvarepsilon},
\end{gather}
with
\begin{gather}
    \pdfrac{\mb{R}}{\bvarepsilon}=\begin{bmatrix}
        \mb{0} \\[4mm]
        -\mathbb{I}^\text{dev}:\mb{E}
    \end{bmatrix},
\end{gather}
thus, the final expression of the consistent tangent stiffness is
\begin{gather}
    \ddfrac{\bsigma}{\bvarepsilon}=\mb{E}-\mb{E}\mathbb{I}^\text{dev}:\underbrace{\begin{bmatrix}
            \pdfrac{f}{\bs} & \gamma\pdfrac{^2f}{\bs^2}
        \end{bmatrix}}_{6\times7}\mb{J}^{-1}\underbrace{\begin{bmatrix}
            \mb{0} \\[4mm]
            \mathbb{I}^\text{dev}:\mb{E}
        \end{bmatrix}}_{7\times6}.
\end{gather}
The term $\mathbb{I}^\text{dev}:\mb{E}$ can be equivalently expressed in matrix notation such that
\begin{gather}
    \mathbb{I}^\text{dev}:\mb{E}=\mb{E}\mb{I}^\text{dev}=\mb{I}^\text{dev}\mb{E},
\end{gather}
then
\begin{gather}
    \ddfrac{\bsigma}{\bvarepsilon}=\mb{E}-\mb{I}^\text{dev}\mb{E}\underbrace{\begin{bmatrix}
            \pdfrac{f}{\bs} & \gamma\pdfrac{^2f}{\bs^2}
        \end{bmatrix}}_{6\times7}\mb{J}^{-1}\underbrace{\begin{bmatrix}
            \mb{0} \\[4mm]
            \mb{I}^\text{dev}\mb{E}
        \end{bmatrix}}_{7\times6}.
\end{gather}
The above expression is in pure matrix form.
\subsection{Kinematic Hardening Extension}
Common orthotropic materials such as timber, bones, etc., do not exhibit kinematic hardening, this is the reason that kinematic hardening was not introduced in the previous sections.
However, as the YLD0418P yield criterion is widely used in the context of sheet metals, extending the model to include kinematic hardening is meaningful.

With the introduction of the back stress $\ba$, the corresponding shifted stress shall be defined as the difference between $\bs$ and $\ba$ as
\begin{gather}
    \beeta=\bs-\ba.
\end{gather}
The evolution of $\ba$ can be defined as
\begin{gather}
    \dot{\ba}=k_r\left(\sqrt{\dfrac{2}{3}}k_b\dfrac{\bn}{\norm{\bn}}-\ba\right)\gamma=k_r\left(\sqrt{\dfrac{2}{3}}k_b\bu-\ba\right)\gamma.
\end{gather}
It is very important to point out that the above definition is isotropic, whether it is appropriate with an anisotropic yield criterion remains to be investigated.

Expressing the above evolution rule in its discretised form using the implicit Euler method, one has
\begin{gather}
    \ba=\ba_n+k_r\left(\sqrt{\dfrac{2}{3}}k_b\bu-\ba\right)\gamma.
\end{gather}
Rearranging gives
\begin{gather}
    \left(1+\gamma{}k_r\right)\ba=\ba_n+\gamma\sqrt{\dfrac{2}{3}}k_rk_b\bu.
\end{gather}
Denoting
\begin{gather}
    R_{\ba}=\ba_n+\gamma\sqrt{\dfrac{2}{3}}k_rk_b\bu-\left(1+\gamma{}k_r\right)\ba,
\end{gather}
then the corresponding derivatives are
\begin{gather}
    \pdfrac{R_{\ba}}{\gamma}=\sqrt{\dfrac{2}{3}}k_rk_b\bu-k_r\ba,\\
    \pdfrac{R_{\ba}}{\bs}=\gamma\sqrt{\dfrac{2}{3}}k_rk_b\pdfrac{\bu}{\bs},\\
    \pdfrac{R_{\ba}}{\ba}=\gamma\sqrt{\dfrac{2}{3}}k_rk_b\pdfrac{\bu}{\ba}-\left(1+\gamma{}k_r\right)\mb{I}.
\end{gather}
The term $\pdfrac{\bu}{\bs}$ can be explicitly derived using the chain rule,
\begin{gather}
    \pdfrac{\bu}{\bs}=\pdfrac{\bu}{\bn}:\pdfrac{\bn}{\bs}=\dfrac{1}{\norm{\bn}}\left(\mathbb{I}-\bu\otimes\bu\right):\mathbb{I}^\text{dev}:\pdfrac{^2f}{\bs^2}.
\end{gather}
One must pay extra attention to two double contractions in the above expression, are they identical?
Interested readers are encouraged to verify this by explicitly writing down the matrix form of the above expression.

With the presence of $\ba$, one shall see that now
\begin{gather}
    \mb{\aleph}=\mb{C_\aleph}\beeta,
\end{gather}
and
\begin{gather}
    \pdfrac{\mb{\aleph}}{\bs}=-\pdfrac{\mb{\aleph}}{\ba}.
\end{gather}
Furthermore, since
\begin{gather}
    \pdfrac{\beeta}{\bs}=\mb{I}\quad\text{(Voigt vector notation)},\qquad
    \pdfrac{\beeta}{\bs}=\mathbb{I}\quad\text{(tensor notation)},
\end{gather}
the explicit expression of $\pdfrac{f}{\bs}$ remains unchanged, and
\begin{gather}
    \pdfrac{f}{\ba}=-\pdfrac{f}{\bs}.
\end{gather}
\subsubsection{Local System}
Taking $\ba$ as the additional local variable such that $\mb{x}=\underbrace{\begin{bmatrix}\gamma&\bs&\ba\end{bmatrix}^\mT}_{13\times1}$, now the local system becomes
\begin{gather}
    \mb{R}=\left\{\begin{array}{l}\displaystyle
        \sum_{i=1}^3\sum_{j=1}^3\abs{\alpha_i-\beta_j}^m-4\sigma_y^m, \\[4mm]
        \bs+\mb{E}\bn\gamma-\bs^\text{trial},                         \\[4mm]
        \ba_n+\gamma\sqrt{\dfrac{2}{3}}k_rk_b\bu-\left(1+\gamma{}k_r\right)\ba.
    \end{array}\right.
\end{gather}
The Jacobian is thus
\begin{gather}
    \mb{J}=\underbrace{\begin{bmatrix}
            -4m\sigma_y^{m-1}\ddfrac{\sigma_y}{\varepsilon^p}\norm{\bn}_e & \pdfrac{R_f}{\bs}                                            & -\pdfrac{R_f}{\bs}                                                                \\[4mm]
            \mb{E}\bn                                                     & \mb{I}+\gamma\mb{E}\mathbb{I}^\text{dev}:\pdfrac{^2f}{\bs^2} & -\gamma\mb{E}\mathbb{I}^\text{dev}:\pdfrac{^2f}{\bs^2}                            \\[4mm]
            \sqrt{\dfrac{2}{3}}k_rk_b\bu-k_r\ba                           & \gamma\sqrt{\dfrac{2}{3}}k_rk_b\pdfrac{\bu}{\bs}             & \gamma\sqrt{\dfrac{2}{3}}k_rk_b\pdfrac{\bu}{\ba}-\left(1+\gamma{}k_r\right)\mb{I}
        \end{bmatrix}}_{13\times13}.
\end{gather}
In which the following is used,
\begin{gather}
    \pdfrac{R_f}{\bs}=\pdfrac{f}{\bs}-4m\sigma_y^{m-1}\ddfrac{\sigma_y}{\varepsilon^p}\gamma\ddfrac{\norm{\bn}_e}{\bn}:\mathbb{I}^\text{dev}:\pdfrac{^2f}{\bs^2}.
\end{gather}

As a practice, please derive the consistent tangent stiffness following a similar approach used in the previous section.
\subsection{Implementation}
The following method computes the yield function and its corresponding derivatives/gradients.
\begin{cppcode}
    YLD0418P::compute_yield_surface
\end{cppcode}

The local returning mapping further uses two algorithms depending on whether kinematic hardening is used.
\begin{cppcode}
    YLD0418P::update_trial_status
\end{cppcode}

With kinematic hardening enabled, the local system has a size of \num{13}.
\begin{cppcode}
    YLD0418P::with_kinematic
\end{cppcode}

With kinematic hardening disabled, the local system has a size of \num{7}.
This makes the Jacobian \SI{70}{\percent} smaller compared to the one with kinematic hardening.
\begin{cppcode}
    YLD0418P::without_kinematic
\end{cppcode}
