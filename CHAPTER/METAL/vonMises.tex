\section{von Mises Framework}
Here the uniaxial combined isotropic/kinematic model introduced in \secref{sec:isotropic/kinematic} is reformulated in 3D space. Some difference will be observed, but the final local residual is a scalar equation.
\subsection{Theory}
\subsubsection{Yield Function}
The von Mises yield criterion is adopted,
\begin{gather}
    f=\norm{\beeta}-\sqrt{\dfrac{2}{3}}\sigma^y,
\end{gather}
with $\beeta=\bs-\balpha$ is the shifted stress with $\balpha$ denoting the back stress and $\bs=\dev{\bsigma}$ denoting the deviatoric stress.
By definition, the back stress $\balpha$ is also a deviatoric stress, thus $\tr{\balpha}=0$.
It shifts the centre of yield surface in the deviatoric stress space.

The only purpose of the constant $\sqrt{\dfrac{2}{3}}$ is to produce consistent response under uniaxial loading with the same set of model parameters.
To see this point, consider the uniaxial loading case, which can be represented by the following stress tensor
\begin{gather}
    \bsigma=\begin{bmatrix}
        \sigma & 0 & 0 \\
        0      & 0 & 0 \\
        0      & 0 & 0
    \end{bmatrix},
\end{gather}
in absence of $\balpha$, the shifted stress $\beeta$ is
\begin{gather}
    \beeta=\begin{bmatrix}
        \dfrac{2}{3}\sigma & 0                   & 0                   \\
        0                  & -\dfrac{1}{3}\sigma & 0                   \\
        0                  & 0                   & -\dfrac{1}{3}\sigma
    \end{bmatrix},
\end{gather}
thus, its norm can be computed as
\begin{gather}
    \norm{\beeta}=\sqrt{\left(\dfrac{2}{3}\right)^2+\left(\dfrac{1}{3}\right)^2+\left(\dfrac{1}{3}\right)^2}\sigma=\sqrt{\dfrac{2}{3}}\sigma.
\end{gather}
Inserting it back, the yield function effectively defines $\sigma=\sigma^y$.

There are many equivalent alternative forms of the von Mises yield function.
For example, one can also write it as
\begin{gather}
    f=\sqrt{\dfrac{3}{2}}\norm{\beeta}-\sigma^y=\sqrt{3J_2}-\sigma^y,\qquad
    f=3J_2-\left(\sigma^y\right)^2,
\end{gather}
given that $J_2=\dfrac{1}{2}\beeta:\beeta$.
One may find all those forms (and maybe more) in the literature.
In principle, one can choose any of those forms if the yield function is the only factor considered.
However, accounting for the associated numerical implementation, which involves computing the derivative of $f$, some forms are more convenient than the others.
\subsubsection{Flow Rule}
Assuming associative rule, the flow rule is
\begin{gather}\label{eq:j2_flow}
    \dot{\bvarepsilon^p}=\gamma\pdfrac{f}{\bsigma}=\gamma\pdfrac{\norm{\beeta}}{\bsigma}=\gamma\dfrac{1}{2}\dfrac{2\mathbb{I}^\text{dev}:\beeta}{\norm{\beeta}}=\gamma\dfrac{\beeta}{\norm{\beeta}}=\gamma\bn.
\end{gather}
All analytical formulations are based on tensor notation.
If the above expression is expressed explicitly in tensor components, one could obtain
\begin{gather}
    \underbrace{\begin{bmatrix}
            \dot{\varepsilon^p}_{11} & \dot{\varepsilon^p}_{12} & \dot{\varepsilon^p}_{31} \\
            \dot{\varepsilon^p}_{12} & \dot{\varepsilon^p}_{22} & \dot{\varepsilon^p}_{23} \\
            \dot{\varepsilon^p}_{31} & \dot{\varepsilon^p}_{23} & \dot{\varepsilon^p}_{33}
        \end{bmatrix}}_{\dot{\bvarepsilon^p}}
    =
    \gamma
    \underbrace{\begin{bmatrix}
            n_{11} & n_{12} & n_{31} \\
            n_{12} & n_{22} & n_{23} \\
            n_{31} & n_{23} & n_{33}
        \end{bmatrix}}_{\bn},\qquad\text{in tensor components.}
\end{gather}
We define the scaling vector $\mb{c}=\begin{bmatrix}
        1 & 1 & 1 & 2 & 2 & 2
    \end{bmatrix}^\mT$ and let $\circ$ be the Hadamard (element--wise) product operator, then the above expression is equivalent to
\begin{gather}
    \underbrace{\begin{bmatrix}
            \dot{\varepsilon^p}_{11}  \\
            \dot{\varepsilon^p}_{22}  \\
            \dot{\varepsilon^p}_{33}  \\
            2\dot{\varepsilon^p}_{12} \\
            2\dot{\varepsilon^p}_{23} \\
            2\dot{\varepsilon^p}_{31}
        \end{bmatrix}}_{\dot{\bvarepsilon^p}}
    =
    \gamma\begin{bmatrix}
        1 &   &   &   &   &   \\
          & 1 &   &   &   &   \\
          &   & 1 &   &   &   \\
          &   &   & 2 &   &   \\
          &   &   &   & 2 &   \\
          &   &   &   &   & 2
    \end{bmatrix}
    \underbrace{
        \begin{bmatrix}
            n_{11} \\
            n_{22} \\
            n_{33} \\
            n_{12} \\
            n_{23} \\
            n_{31}
        \end{bmatrix}}_{\bn}=\gamma~\mb{c}\circ\bn,\qquad\text{in the Voigt notation.}
\end{gather}
This agrees with \eqsref{eq:norm_derivative2}.
Such a difference has practical implications.
Due to symmetry of both strain and stress tensors, it is often more performant to just use vectors and matrices to represent second--order and fourth--order tensors in implementation.
This means tensor quantities are expressed in compressed vector/matrix form.
For a given expression, one shall always question what operation it implies and how it would be eventually computed for operands expressed in different forms.
For example, if $\dot{\bvarepsilon^p}$ is used in intermediate computation, is can simply be replaced by $\gamma\bn$ --- the mathematics would be correct as long as we are using the consistent tensor notation.
However, if $\bvarepsilon^p$ needs to be stored in the Voigt notation, one shall carefully scale the shear components by a factor of $2$ when committing new $\bvarepsilon^p$.

It can be observed that $\dot{\bvarepsilon^p}$ has a magnitude of $\gamma$ while $\bn$ is a unit tensor in $\mathbb{R}^3\times\mathbb{R}^3$ hyper space. Thus $\bn$ serves as a direction indicator, $\bvarepsilon^p$ evolves towards $\bn$ by the amount of $\gamma$. Since $\bn$ is deviatoric, $\dot{\bvarepsilon^p}$ is also deviatoric (so as $\bvarepsilon^p$).
Furthermore, since $\bn$ is a unit tensor,
\begin{gather}
    \norm{\dot{\bvarepsilon^p}}=\gamma.
\end{gather}
\subsubsection{Hardening Law}
For internal variable $q$, the hardening law takes the accumulated magnitude of $\bvarepsilon^p$.
\begin{gather}
    \dot{q}=\sqrt{\dfrac{2}{3}}\norm{\dot{\bvarepsilon^p}}=\sqrt{\dfrac{2}{3}}\gamma.
\end{gather}
Similar to the stress counterpart, here the constant $\sqrt{\dfrac{2}{3}}$ needs to be introduced to ensure a consistent and correct uniaxial response.
To see this, consider the uniaxial loading case again, to have a unit plastic strain increment along the designated axis (say, the $x$-axis), also noting that $\dot{\bvarepsilon^p}$ is \textbf{deviatoric}, the full plastic strain increment tensor must be
\begin{gather}
    \dot{\bvarepsilon^p}=\dfrac{1}{2}\begin{bmatrix}
        2 & -1 & -1 & 0 & 0 & 0
    \end{bmatrix}^\mT.
\end{gather}
Clearly, to have a unit first component, the other two normal components must be $-\dfrac{1}{2}$ each.
This will lead to $\norm{\dot{\bvarepsilon^p}}=\sqrt{\dfrac{3}{2}}$.
If we still accept the definition $\dot{q}=\norm{\dot{\bvarepsilon^p}}$, then the same unit plastic strain increment that yields $\dot{q}=1$ in the uniaxial formulation would now give $\dot{q}=\sqrt{\dfrac{3}{2}}$ in the 3D formulation.
As a result, the same hardening function would produce different responses in two cases.
To have the identical $\dot{q}$, we must scale down $\norm{\dot{\bvarepsilon^p}}$ by $\sqrt{\dfrac{2}{3}}$, thus the above expression is obtained.

For isotropic hardening, $\sigma^y$ is defined as a general function of $q$,
\begin{gather}
    \sigma^y=\sigma^y\left(q\right).
\end{gather}

For kinematic hardening, the evolution law of back stress $\balpha$ is defined to be
\begin{gather}
    \dot{\balpha}=\sqrt{\dfrac{2}{3}}\dot{H}\bn.
\end{gather}
in which $H=H\left(q\right)$ is now a scalar--valued function of $q$ that controls the development of $\norm{\balpha}$, $\balpha$ always evolves towards $\bn$ by the amount $\dot{H}=H\left(q_{n+1}\right)-H\left(q_n\right)$ characterising the increment of $H$. The fraction $\sqrt{\dfrac{2}{3}}$ is introduced for consistent response as stated earlier. Since $\dot{\balpha}$ and $\bn$ are coaxial, $\balpha$ stays deviatoric but may not be coaxial with all $\bn$ through the loading process.
\subsection{Formulation}
The summation of the von Mises model is listed as follows.
\begin{table}[ht]
    \centering
    \begin{tabular}{rl}
        \toprule
        Constitutive Law & $\bsigma=\mb{D}:\left(\bvarepsilon-\bvarepsilon^p\right)$ \\
        Yield Function   & $f=\norm{\beeta}-\sqrt{\dfrac{2}{3}}\sigma^y$             \\
        Flow Rule        & $\dot{\bvarepsilon^p}=\gamma\bn$                          \\
        Hardening Law    & $\dot{q}=\sqrt{\dfrac{2}{3}}\gamma$                       \\
                         & $\dot{\balpha}=\sqrt{\dfrac{2}{3}}\dot{H}\bn$             \\\bottomrule
    \end{tabular}
\end{table}
\subsubsection{Elastic Loading/Unloading}
The trial stress can be computed such as
\begin{gather}\label{eq:j2_tsigma}
    \bsigma^\text{trial}=\mb{D}:\left(\bvarepsilon_{n+1}-\bvarepsilon^p_n\right)=\bsigma_n+\mb{D}:\left(\bvarepsilon_{n+1}-\bvarepsilon_n\right).
\end{gather}
In matrix representation, it is
\begin{gather}
    \underbrace{
        \begin{bmatrix}
            \sigma^\text{trial}_{11} \\
            \sigma^\text{trial}_{22} \\
            \sigma^\text{trial}_{33} \\
            \sigma^\text{trial}_{12} \\
            \sigma^\text{trial}_{23} \\
            \sigma^\text{trial}_{31}
        \end{bmatrix}}_{\bsigma^\text{trial}}
    =
    \underbrace{\begin{bmatrix}
            \lambda+2G & \lambda    & \lambda    & \cdot & \cdot & \cdot \\
            \lambda    & \lambda+2G & \lambda    & \cdot & \cdot & \cdot \\
            \lambda    & \lambda    & \lambda+2G & \cdot & \cdot & \cdot \\
            \cdot      & \cdot      & \cdot      & 2G    & \cdot & \cdot \\
            \cdot      & \cdot      & \cdot      & \cdot & 2G    & \cdot \\
            \cdot      & \cdot      & \cdot      & \cdot & \cdot & 2G
        \end{bmatrix}}_{\mb{D}}
    \underbrace{\left(\begin{bmatrix}
            \varepsilon_{11,n+1} \\
            \varepsilon_{22,n+1} \\
            \varepsilon_{33,n+1} \\
            \varepsilon_{12,n+1} \\
            \varepsilon_{23,n+1} \\
            \varepsilon_{31,n+1}
        \end{bmatrix}-\begin{bmatrix}
            \varepsilon^p_{11,n} \\
            \varepsilon^p_{22,n} \\
            \varepsilon^p_{33,n} \\
            \varepsilon^p_{12,n} \\
            \varepsilon^p_{23,n} \\
            \varepsilon^p_{31,n}
        \end{bmatrix}
        \right).}_{\bvarepsilon_{n+1}-\bvarepsilon^p_n}
\end{gather}
Using engineering strains, the above must be adjusted to
\begin{gather}
    \underbrace{
        \begin{bmatrix}
            \sigma^\text{trial}_{11} \\
            \sigma^\text{trial}_{22} \\
            \sigma^\text{trial}_{33} \\
            \sigma^\text{trial}_{12} \\
            \sigma^\text{trial}_{23} \\
            \sigma^\text{trial}_{31}
        \end{bmatrix}}_{\bsigma^\text{trial}}
    =
    \underbrace{\begin{bmatrix}
            \lambda+2G & \lambda    & \lambda    & \cdot & \cdot & \cdot \\
            \lambda    & \lambda+2G & \lambda    & \cdot & \cdot & \cdot \\
            \lambda    & \lambda    & \lambda+2G & \cdot & \cdot & \cdot \\
            \cdot      & \cdot      & \cdot      & G     & \cdot & \cdot \\
            \cdot      & \cdot      & \cdot      & \cdot & G     & \cdot \\
            \cdot      & \cdot      & \cdot      & \cdot & \cdot & G
        \end{bmatrix}}_{\mb{D}\text{ or conventionally }\mb{E}}
    \underbrace{\left(\begin{bmatrix}
            \varepsilon_{11,n+1} \\
            \varepsilon_{22,n+1} \\
            \varepsilon_{33,n+1} \\
            \gamma_{12,n+1}      \\
            \gamma_{23,n+1}      \\
            \gamma_{31,n+1}
        \end{bmatrix}-\begin{bmatrix}
            \varepsilon^p_{11,n} \\
            \varepsilon^p_{22,n} \\
            \varepsilon^p_{33,n} \\
            \gamma^p_{12,n}      \\
            \gamma^p_{23,n}      \\
            \gamma^p_{31,n}
        \end{bmatrix}
        \right).}_{\bvarepsilon_{n+1}-\bvarepsilon^p_n}
\end{gather}

Then $\beeta^\text{trial}=\dev{\bsigma^\text{trial}}-\balpha_n$, which gives trial yield function
\begin{gather}\label{eq:j2_tf}
    f^\text{trial}=\norm{\beeta^\text{trial}}-\sqrt{\dfrac{2}{3}}\sigma^y_n
\end{gather}
with $\sigma^y_n=\sigma^y\left(q_n\right)$ evaluated with current $q_n$.
The above expression simply assumes the current loading increment $\Delta\bvarepsilon=\bvarepsilon_{n+1}-\bvarepsilon_n$ is purely elastic, thus all plasticity related variables remain unchanged.
The yield function evaluated in this way gives an upper bound of the actual yield function.
If this value is negative, the actual state must be elastic, otherwise, plasticity evolution must occur.
\subsubsection{Plastic Evolution}
By default, we present the formulation with the implicit Euler method.

If plasticity evolution occurs, that is, $f^\text{trial}>0$, $\gamma$ must be non-zero and thus needs to be solved.
\begin{gather}
    \beeta_{n+1}=\dev{\bsigma_{n+1}}-\balpha_{n+1}.
\end{gather}
Accounting for
\begin{gather}
    \bsigma_{n+1}=\bsigma^\text{trial}-\mb{D}:\dot{\bvarepsilon^p}=\bsigma^\text{trial}-\gamma2G\bn,\\
    \balpha_{n+1}=\balpha_n+\sqrt{\dfrac{2}{3}}\dot{H}\bn,
\end{gather}
one can further derive
\begin{gather}
    \beeta_{n+1}=\dev{\bsigma^\text{trial}-\gamma2G\bn}-\balpha_n-\sqrt{\dfrac{2}{3}}\dot{H}\bn.
\end{gather}
Since $\bn$ is already deviatoric, meaning $\dev{\bn}=\bn$, then,
\begin{gather}
    \begin{split}
        \beeta_{n+1} & =\dev{\bsigma^\text{trial}}-\gamma2G\bn-\balpha_n-\sqrt{\dfrac{2}{3}}\dot{H}\bn \\
                     & =\beeta^\text{trial}-\left(2G\gamma+\sqrt{\dfrac{2}{3}}\dot{H}\right)\bn.
    \end{split}
\end{gather}
Noting that, by definition, $\bn=\dfrac{\beeta_{n+1}}{\norm{\beeta_{n+1}}}$, thus,
\begin{gather}
    \underbrace{\left(1+\dfrac{2G\gamma+\sqrt{\dfrac{2}{3}}\dot{H}}{\norm{\beeta_{n+1}}}\right)}_{\text{scalar}}\beeta_{n+1}=\beeta^\text{trial}.
\end{gather}
The above expression implies that $\beeta_{n+1}$ and $\beeta^\text{trial}$ are \textbf{coaxial}. Thus, $\beeta_{n+1}$ always points to the direction of $\beeta^\text{trial}$, which is a constant in each time step within that time step.
Only its magnitude would be adjusted in local iterations.
Thus, $\bn=\dfrac{\beeta_{n+1}}{\norm{\beeta_{n+1}}}=\dfrac{\beeta^\text{trial}}{\norm{\beeta^\text{trial}}}$ is also a constant during the local iteration.
This is a quite convenient property, although it may not exist in other complex models.
However, when it is available, it can be exploited to simplify the formulation.
One can further derive
\begin{gather}
    \norm{\beeta_{n+1}}+2G\gamma+\sqrt{\dfrac{2}{3}}\dot{H}=\norm{\beeta^\text{trial}}.
\end{gather}

The yield function evaluated at the new state thus reads
\begin{gather}\label{eq:j2_f}
    f=\norm{\beeta^\text{trial}}-\left(2G\gamma+\sqrt{\dfrac{2}{3}}\left(H_{n+1}-H_n\right)\right)-\sqrt{\dfrac{2}{3}}\sigma^y_{n+1}.
\end{gather}

The Jacobian reads
\begin{gather}
    \pdfrac{f}{\gamma}=-2G-\sqrt{\dfrac{2}{3}}\ddfrac{H_{n+1}}{q_{n+1}}\ddfrac{q_{n+1}}{\gamma}-\sqrt{\dfrac{2}{3}}\ddfrac{\sigma^y_{n+1}}{q_{n+1}}\ddfrac{q_{n+1}}{\gamma}.
\end{gather}
Since $q_{n+1}=q_n+\sqrt{\dfrac{2}{3}}\gamma$, $\ddfrac{q_{n+1}}{\gamma}=\sqrt{\dfrac{2}{3}}$. Hence,
\begin{gather}\label{eq:j2_df}
    \pdfrac{f}{\gamma}=-2G-\dfrac{2}{3}\ddfrac{H_{n+1}}{q_{n+1}}-\dfrac{2}{3}\ddfrac{\sigma^y_{n+1}}{q_{n+1}}.
\end{gather}
\subsubsection{Consistent Tangent Stiffness}
From $\bsigma_{n+1}=\bsigma^\text{trial}-\gamma2G\bn$, as $\bn=\dfrac{\beeta}{\norm{\beeta}}=\dfrac{\beeta^\text{trial}}{\norm{\beeta^\text{trial}}}$, the consistent tangent stiffness can be computed via the chain rule as
\begin{gather}
    \pdfrac{\bsigma_{n+1}}{\bvarepsilon_{n+1}}=\pdfrac{\bsigma_{n+1}^\text{trial}}{\bvarepsilon_{n+1}}-2G\pdfrac{\left(\gamma\bn\right)}{\bvarepsilon_{n+1}}=\mb{D}-2G\left(\bn\otimes\pdfrac{\gamma}{\bvarepsilon_{n+1}}+\gamma\pdfrac{\bn}{\bvarepsilon_{n+1}}\right).
\end{gather}
In which, according to \eqsref{eq:unit_derivative},
\begin{gather}
    \begin{split}
        \pdfrac{\bn}{\bvarepsilon_{n+1}} & =\dfrac{1}{\norm{\beeta^\text{trial}}}\left(\mathbb{I}-\bn\otimes\bn\right):\pdfrac{\mb{\beeta}^\text{trial}}{\bvarepsilon_{n+1}} \\
                                         & =\dfrac{2G}{\norm{\beeta^\text{trial}}}\left(\mathbb{I}-\bn\otimes\bn\right):\mathbb{I}^\text{dev}                                \\
                                         & =\dfrac{2G}{\norm{\beeta^\text{trial}}}\left(\mathbb{I}^\text{dev}-\bn\otimes\bn\right).
    \end{split}
\end{gather}
Here, $\bn$ is expressed as $\bn=\dfrac{\beeta^\text{trial}}{\norm{\beeta^\text{trial}}}$ due to coaxiality between $\beeta_{n+1}$ and $\beeta^\text{trial}$.
This simplifies the computation.

From converged local residual (yield function),
\begin{gather}
    \begin{split}
        \pdfrac{\gamma}{\bvarepsilon_{n+1}} & =-\left(\pdfrac{f}{\gamma}\right)^{-1}\pdfrac{f}{\bvarepsilon_{n+1}}=-\left(\pdfrac{f}{\gamma}\right)^{-1}2G\bn.
    \end{split}
\end{gather}

Thus the final expression for consistent tangent stiffness can be assembled as
\begin{gather}\label{eq:j2_stiffness}
    \begin{split}
        \pdfrac{\bsigma_{n+1}}{\bvarepsilon_{n+1}} & =\mb{D}-2G\left(-2G\left(\pdfrac{f}{\gamma}\right)^{-1}\bn\otimes\bn+\gamma\dfrac{2G}{\norm{\beeta^\text{trial}}}\left(\mathbb{I}^\text{dev}-\bn\otimes\bn\right)\right)                                                                               \\
                                                   & =\mb{D}+4G^2\left(\pdfrac{f}{\gamma}\right)^{-1}\bn\otimes\bn+\dfrac{4G^2\gamma}{\norm{\beeta^\text{trial}}}\left(\bn\otimes\bn-\mathbb{I}^\text{dev}\right)                                                                                           \\
                                                   & =\mb{D}+4G^2\left(\left(\pdfrac{f}{\gamma}\right)^{-1}+\dfrac{\gamma}{\norm{\beeta^\text{trial}}}\right)\bn\otimes\bn-\dfrac{4G^2\gamma}{\norm{\beeta^\text{trial}}}\mathbb{I}^\text{dev}                                                              \\
                                                   & =\mb{D}+4G^2\left(\dfrac{\gamma}{\norm{\beeta^\text{trial}}}-\dfrac{1}{2G+\dfrac{2}{3}\ddfrac{H_{n+1}}{q_{n+1}}+\dfrac{2}{3}\ddfrac{\sigma^y_{n+1}}{q_{n+1}}}\right)\bn\otimes\bn-\dfrac{4G^2\gamma}{\norm{\beeta^\text{trial}}}\mathbb{I}^\text{dev}.
    \end{split}
\end{gather}
It is a symmetric tensor/matrix.
It shall be noted that $\mathbb{I}^\text{dev}$ takes the form as presented in \eqsref{eq:dev_tensor_se}.
Readers are strongly suggested to derive it via both tensor notation and compressed matrix representation as a practice.
Both shall lead to identical results.

Since the local iteration is a scalar function, the closed--form of consistent tangent stiffness is relatively easy to compute. It will be seen in more complex models that closed--forms do not always possess simple forms.

As a general framework, the above formulation does not require explicit forms of $H\left(q\right)$ and $\sigma^y\left(q\right)$. Thus, various types of scalar--valued functions can be adopted.
\subsection{Implementation}
The state determination algorithm of this general model incorporating von Mises criterion is given in \algoref{algo:j2_model}.
\begin{breakablealgorithm}
    \caption{state determination of general von Mises model}\label{algo:j2_model}
    \begin{algorithmic}
        \State \textbf{Parameter}: $\lambda$, $G$
        \State \textbf{Input}: $\bvarepsilon_{n+1}$, $\bvarepsilon_n$, $\bvarepsilon^p_n$, $\bsigma_n$, $\balpha_n$, $q_n$
        \State \textbf{Output}: $\mb{D}_{n+1}$, $\bvarepsilon^p_{n+1}$, $\bsigma_{n+1}$, $\balpha_{n+1}$, $q_{n+1}$
        \State compute $\bsigma^\text{trial}$, $\beeta^\text{trial}$, $\bn$ and $f^\text{trial}$\Comment{\eqsref{eq:j2_tsigma} and \eqsref{eq:j2_tf}}
        \If {$f^\text{trial}\geqslant0$}
        \State $\gamma=0$
        \While{true}
        \State compute $f$ and $\pdfrac{f}{\gamma}$\Comment{\eqsref{eq:j2_f} and \eqsref{eq:j2_df}}
        \State update $\Delta{}H=H\left(q_{n+1}\right)-H\left(q_n\right)$
        \State $\Delta\gamma=\left(\pdfrac{f}{\gamma}\right)^{-1}f$
        \If {$\abs{\Delta\gamma}<\text{tolerance}$}
        \State break
        \EndIf
        \State $\gamma\leftarrow\gamma-\Delta\gamma$
        \State $q_{n+1}=q_n+\sqrt{\dfrac{2}{3}}\gamma$
        \EndWhile
        \State $\bsigma_{n+1}=\bsigma^\text{trial}-\gamma2G\bn$
        \State $\bvarepsilon^p_{n+1}=\bvarepsilon^p_n+\gamma\bn$
        \State $\balpha_{n+1}=\balpha_n+\sqrt{\dfrac{2}{3}}\Delta{}H\bn$
        \State $q_{n+1}=q_n+\sqrt{\dfrac{2}{3}}\gamma$
        \State compute $\mb{D}_{n+1}$\Comment{\eqsref{eq:j2_stiffness}}
        \Else
        \State $\bsigma_{n+1}=\bsigma^\text{trial}$
        \State $\bvarepsilon^p_{n+1}=\bvarepsilon^p_n$
        \State $\balpha_{n+1}=\balpha_n$
        \State $q_{n+1}=q_n$
        \State $\mb{D}_{n+1}=\mb{D}$
        \EndIf
    \end{algorithmic}
\end{breakablealgorithm}
It shall be noted that the algorithm does not implement $H\left(q\right)$ and $\sigma^y\left(q\right)$. It is assumed those two functions are defined somewhere else and are able to provide derivatives.

Depending on the choice of updating stress as in \eqsref{eq:j2_tsigma}, the history of $\bvarepsilon^p$ is \textbf{not} compulsory in this model if the latter expression is used instead of the former.
\subsection{Closing Remarks}
As the first 3D material model introduced, the von Mises framework allows beginners to get familiar with multiaxial constitutive modelling with a relatively smooth learning curve. The formulation is expressed in tensor notation. Readers are strongly encouraged to derive the formulation from three governing equations independently in both tensor and compressed matrix notions separately. It is a good practice to get each tiny detail correct.
\begin{cppcode}
    NonlinearJ2::update_trial_status
\end{cppcode}

Finally, in \eqsref{eq:j2_flow}, we have discussed that the same expression
\begin{gather}
    \dot{\bvarepsilon^p}=\gamma\bn
\end{gather}
may have different explicit forms, depending on how those quantities are represented.

The $\dot{\bvarepsilon^p}$ is further used in
\begin{gather}\label{eq:j2_two_form}
    \bs^\text{trial}-\bs_{n+1}=2G\dot{\bvarepsilon^p}.
\end{gather}
The above expression assumes the tensor notation.
If the matrix notation is used, it can be explicitly written as
\begin{gather}
    \begin{bmatrix}
        s^\text{trial}_{11}-s_{11,n+1} \\
        s^\text{trial}_{22}-s_{22,n+1} \\
        s^\text{trial}_{33}-s_{33,n+1} \\
        s^\text{trial}_{12}-s_{12,n+1} \\
        s^\text{trial}_{23}-s_{23,n+1} \\
        s^\text{trial}_{31}-s_{31,n+1}
    \end{bmatrix}=\gamma\begin{bmatrix}
        2G &    &    &   &   &   \\
           & 2G &    &   &   &   \\
           &    & 2G &   &   &   \\
           &    &    & G &   &   \\
           &    &    &   & G &   \\
           &    &    &   &   & G
    \end{bmatrix}\diag{\mb{c}}\bn.
\end{gather}
One immediately realises that
\begin{gather}
    \diag{\begin{matrix}
            2G \\2G\\2G\\G\\G\\G
        \end{matrix}}\circ\diag{\mb{c}}\bn=\diag{\begin{matrix}
            2G \\2G\\2G\\2G\\2G\\2G
        \end{matrix}}\bn=2G\bn,
\end{gather}
thus, \eqsref{eq:j2_two_form} becomes
\begin{gather}
    \bs^\text{trial}-\bs_{n+1}=\gamma2G\bn.
\end{gather}
No matter which notation is used, the same expression holds.
This is based on the fact that $\dot{\bvarepsilon^p}$ is used as an intermediate variable.
The intermediate scaling matrices cancel out and eventually the same expression is obtained.

This is a beautiful attribute, though could be confusing for beginners.
